const malware = {};

malware.scrambler = async sys=>{
	for (let dir in sys.fs)
		for (const f in sys.fs[dir]) {
			const c = sys.fs[dir][f];

			if (typeof c == "string")
				sys.fs[dir][f] = game.lib.shuffle([...c]).join("");
			else if (c.content)
				sys.fs[dir][f].content = game.lib.shuffle([...c.content]).join("");
		}
	
	await game.db.set("systems", sys.id, sys);
}

malware.miner = async sys=>{
	let f;

	f = ()=>{
		let m = Math.floor(Math.random()*15)+10;
		m = m*60000;

		game.systems.jobs.create(sys, ".bitminer", async()=>{
			const s = await game.db.get("systems", sys.id);
	
			const amt = Math.floor(Math.random()*15)+(5*s.hardware.cpu);
			console.log(`Miner generated ${amt} bits`);
			s.bits += amt;
			await game.db.set("systems", s.id, s);

			f();
		}, m, {
			malware: true
		});
	};

	f();
};

module.exports = malware;